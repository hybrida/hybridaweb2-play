@(user: User, edit: Boolean, canEdit:Boolean, messages: java.util.List[Html], subTitle: String, imageFile: String)

@infoItemTop(label:String) = {
    <li>
        <div class="label">@label</div>
        <div class="info">
}
@infoItemBottom(edit:Boolean, value:String, output:String = null) = {
            @if(!edit){
                @if(output == null){ @value}else{ @output}
            }
        </div>
        <div class="clearfix"></div>
    </li>
}

@inputItem(edit:Boolean, label:String, value:String, name: String = "", inputType:String = "text", output:String = null) = {
    @infoItemTop(label)
    @if(edit){
        <div class="input-container">
            <input type="@inputType" name="@name" value="@value">
        </div>}
    @infoItemBottom(edit, value, output)
}

@dropDownItem(edit:Boolean, label:String, value:String, name: String = "", options: Array[String], output:String = null) = {
    @infoItemTop(label)
    @if(edit){
        <div class="select-container">
            <select name="@name">
                @for(option <- options) {
                    <option value="@option"@if(value == option){ selected="selected"}>@option</option>
                }
            </select>
        </div>
    }
    @infoItemBottom(edit, value, output)
}


@layoutWithHead("Hybrida - " + user.getName) {
    <div class="page">
        <div class="buttons">
        @if(edit) {
            <input class="float-right btn btn-primary" type="submit" value="Lagre">
            <a class="float-right btn btn-primary" href="@profile.routes.Profile.index(user.getUsername)">Avbryt</a>
        } else {
            <a class="float-right btn btn-primary" href="@profile.routes.Profile.edit(user.getUsername)">Rediger</a>
        }
        </div>
        @if(edit) {
            <form method="POST" action="@profile.routes.Profile.update(user.getUsername)" onsubmit="$('#profile_image_file').prop('disabled', true)">
            }
        <h5 class="smallTitle">@user.getName@if(subTitle != null && !subTitle.equals("")) { - @subTitle}</h5>
        <div class="pageInner @if(edit){edit}else{nedit}">
            @if(edit || imageFile != null && !imageFile.equals("")) {
                <div class="pageItem">
                    @if(edit){
                        <h3 class="bigSubTitle">PROFILBILDE</h3>
                        <input type="file" name="profileImageFile" class="profile-image-file-input hidden">
                        <input type="hidden" name="profileImageFileName" class="profile-image-file-name" value="@user.getProfileImageFileName">
                    }
                    <div class="picFrame poof">
                        @if(edit){
                            <img class="loader" src="@routes.Assets.at("images/ajax-loader.gif")">
                        }
                        <img class="pic" src="@(if(imageFile != null && !imageFile.equals("")) {
                            routes.Assets.at(imageFile)
                        } else {
                            routes.Assets.at("images/placeholder-profile.jpg")
                        })" @if(user.hasProfileImagePos && !edit){style="transform: translateY(@(user.getProfileImagePos)%)"}>
                        @if(edit){
                            <div class="pic-inner">
                                <div class="link-container">
                                    <div class="link ajaxUpload"><span class="glyphicon glyphicon-ajaxUpload"></span> Last opp bilde</div>
                                    <div class="link remove@if(imageFile == null || imageFile.equals("")){ hidden}">
                                        <span class="glyphicon glyphicon-remove-circle"></span> Fjern bildet
                                    </div>
                                </div>
                                <div class="drop hidden"><span class="glyphicon glyphicon-ajaxUpload"></span> Slipp for å laste opp</div>
                            </div>
                        }
                    </div>
                </div>
            }
            @if(!edit) {
                <h1 class="pageItem bigTitle">@user.getName</h1>
                @if(subTitle != null && !subTitle.equals("")) {
                    <h3 class="pageItem bigSubTitle">@subTitle</h3>
                }
            }

            @if(!messages.isEmpty) {
                <div class="messages">@(for(message <- messages) message)</div>
            }
            <div class="pageItem info-block-container">
                @if(edit){<h3 class="bigSubTitle">BRUKERINFO</h3>}

                @if(edit) {
                    <div class="info-block">
                        <ul>
                            @inputItem(false, "NTNU-BRUKERNAVN", user.getUsername)
                        </ul>
                    </div>
                    <div class="info-block">
                        <ul>
                            @inputItem(true, "FORNAVN", user.getFirstName, "firstName")
                            @inputItem(true, "MELLOMNAVN", user.getMiddleName, "middleName")
                            @inputItem(true, "ETTERNAVN", user.getLastName, "lastName")
                        </ul>
                    </div>
                }
                <div class="info-block">
                    <ul>
                        @if(!edit){ @inputItem(false, "NTNU-E-POST", user.getUsername+"@stud.ntnu.no")}
                        @if(edit || user.hasEmail){ @inputItem(edit, "ALTERNATIV E-POST", user.getEmail, "email", "email")}
                        @if(edit || user.hasWebsiteUrl){ @inputItem(edit, "HJEMMESIDE", user.getWebsiteUrl, "websiteUrl")}
                        @if(edit || user.hasPhone){ @inputItem(edit, "TELEFON", user.getPhone, "phone")}
                    </ul>
                </div>
                <div class="info-block">
                    <ul>
                        @if(edit || user.hasTitle){ @inputItem(edit, "TITTEL", user.getTitle, "title")}
                        @if(edit || user.hasGraduationYear){ @inputItem(edit, "AVGANGSÅR",
                            user.getGraduationYear.toString, "graduationYear", "number")}
                        @if(edit || user.hasSpecialization){ @dropDownItem(edit, "SPESIALISERING",
                            if(user.hasSpecialization) user.getSpecialization.toString else "",
                            "specialization", User.Specialization.displayNames())}
                    </ul>
                </div>
            </div>

            <div class="clearfix">
            </div>
        </div>
        @if(edit) {
        </form>
        }
    </div>
} {
    <link rel="stylesheet" type="text/css" href="@routes.Assets.at("stylesheets/profile.css")" />
    <script type="text/javascript">
        function calculatePicTop(){
            var pic = $(".nedit .pic");
            pic.css("width", "auto");
            pic.css("height", "auto");
            if (pic.height() < parseFloat($(".picFrame").css("max-height"))) {
                pic.css("top", pic.height()/2 + "px");
            } else pic.css("top", "50%");
            pic.css("width", "");
            pic.css("height", "");
        }

        function uploadImage(filesParent){
            $(".picFrame .link, .picFrame .drop, .pic").addClass("hidden");
            uploadFile(filesParent.files[0], function(url) {
                var filename = url.substring(url.lastIndexOf("/")+1);
                $(".profile-image-file-name").val(filename);
                $(".pic").attr("src", url);
                $(".picFrame").removeClass("hidden");
                $(".picFrame .link, .pic").removeClass("hidden");
                $(".picFrame").addClass("poof");
            }, "@user.getUsername");
            calculatePicTop();
        }

        $(document).ready(function(){
            calculatePicTop();
            $(".edit .picFrame .ajaxUpload").click(function(){$(".profile-image-file-input").click()});
            $(".edit .picFrame .remove").click(function(){
                $(".pic").attr("src", "@routes.Assets.at("images/placeholder-profile.jpg")");
                $(".profile-image-file-name").val("");
                $(".picFrame .remove").addClass("hidden");
                calculatePicTop();
            });
            $(".edit .picFrame").on("dragover", function(jqe) {
                    var e = jqe.originalEvent;
                    e.stopPropagation();
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'copy';
                }).on("dragenter", function(jqe) {
                    var e = jqe.originalEvent;
                    e.stopPropagation();
                    e.preventDefault();
                    $(".picFrame").removeClass(".poof");
                }).on("dragleave", function(jqe) {
                    var e = jqe.originalEvent;
                    e.stopPropagation();
                    e.preventDefault();
                    $(".picFrame").addClass(".poof");
                }).on("drop", function(jqe) {
                    var e = jqe.originalEvent;
                    e.stopPropagation();
                    e.preventDefault();
                    uploadImage(e.dataTransfer);
                });
            $(".profile-image-file-input").change(function(){uploadImage(this);});
        });
    </script>
}