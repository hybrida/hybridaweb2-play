<meta charset='utf-8' />
<link href='assets/fullcalendar/fullcalendar.css' rel='stylesheet' />
<link href='assets/fullcalendar/fullcalendar.print.css' rel='stylesheet' media='print' />
<script src='assets/fullcalendar/lib/moment.min.js'></script>
<script src='assets/javascripts/jquery-1.11.2.min.js'></script>
<script src='assets/fullcalendar/fullcalendar.min.js'></script>
<script src='assets/fullcalendar/lang/no.js'></script>
<script>

    $(document).ready(function() {

        $('#calendar').fullCalendar({
            lang: "no",
            header: {
                left: "prev,next today",
                center: "title",
                right: "month,agendaWeek,agendaDay"
            },
            editable: @(models.LoginState.getUser().canCreateNewArticle()),
            eventDrop: function(event, revertFunc) {
                if (event.id == null || event.id == "") {
                    revertFunc();
                } else if (!confirm("Er du sikker p√• denne endringen?")) {
                    revertFunc();
                } else {
                    $.get("kalender/forandre?id="+event.id+"&start="+event.start+"&end="+event.end,function(data) {
                        if (data != "true") {
                            revertFunc(); //TODO: not working, returns: "Uncaught TypeError: object is not a function"
                            error("Noe gikk galt, er du logget inn?");
                        }
                    });
                }
            },
            eventLimit: true, // allow "more" link when too many events
            events: {
                url: "kalender/fa", //Kan ikke reverse route
                error: function() {
                    $("#script-warning").show();
                }
            },
            loading: function(bool) {
                $("#loading").toggle(bool);
            }
        });

    });

</script>
<style>
    #script-warning {
        display: none;
        background: #eee;
        border-bottom: 1px solid #ddd;
        padding: 0 10px;
        line-height: 40px;
        text-align: center;
        font-weight: bold;
        font-size: 12px;
        color: red;
    }

    #loading {
        display: none;
        position: absolute;
        top: 10px;
        right: 10px;
    }

    #calendar {
        max-width: 900px;
        margin: 40px auto;
        padding: 0 10px;
    }

</style>