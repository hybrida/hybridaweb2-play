@(user: User, edit: Boolean = false, messages: java.util.List[Html], subTitle: String = null, imageFile: String = null)

@infoItem(display:Boolean, input:Boolean, label:String, value:String, name: String = "", inputType:String = "text", output:String = null) = {
    @if(display) {
    <li>
        <div class="label">@label</div>
        <div class="info">
            @if(input){
                <input type="@inputType" name="@name" value="@value">
            }else{
                @if(output == null){ @value}else{ @output}
            }
        </div>
        <div class="clearfix"></div>
    </li>
    }
}


@layoutWithHead("Hybrida - " + user.getName) {
    <div class="page">
        @if(edit) {
            <form method="POST" action="@profile.routes.Profile.update(user.getUsername)" onsubmit="$('#profile_image_file').prop('disabled', true)">
            }
        <h5 class="smallTitle">@user.getName@if(subTitle != null && !subTitle.equals("")) { - @subTitle}</h5>
        <div class="buttons">
        @if(edit) {
            <input class="float-right btn btn-primary" type="submit" value="Lagre">
            <a class="float-right btn btn-primary" href="@profile.routes.Profile.index(user.getUsername)">Avbryt</a>
        } else {
            <a class="float-right btn btn-primary" href="@profile.routes.Profile.edit(user.getUsername)">Rediger</a>
        }
        </div>
        <div class="pageInner @if(edit){edit}else{nedit}">
            @if(edit || imageFile != null && !imageFile.equals("")) {
                <div class="pageItem">
                    @if(edit){
                        <h3 class="bigSubTitle">PROFILBILDE</h3>
                        <input type="file" name="profileImageFile" class="profile-image-file-input hidden">
                        <input type="hidden" name="profileImageFileName" class="profile-image-file-name" value="@user.getProfileImageFileName">
                    }
                    <div class="picFrame poof">
                        @if(edit){
                        <div>
                            <div class="link upload"><span class="glyphicon glyphicon-upload"></span> Last opp bilde</div>
                            <div class="link remove@if(imageFile == null || imageFile.equals("")){ hidden}">
                                <span class="glyphicon glyphicon-remove-circle"></span> Fjern bildet
                            </div>
                            <div class="drop hidden"><span class="glyphicon glyphicon-upload"></span> Slipp for å laste opp</div>
                            <img class="loader hidden" src="@routes.Assets.at("images/ajax-loader.gif")">
                        </div>
                        }
                        <img class="pic" src="@(if(imageFile != null && !imageFile.equals("")) {
                            routes.Assets.at(imageFile)
                        } else {
                            routes.Assets.at("images/placeholder-profile.jpg")
                        })" @if(user.hasProfileImagePos && !edit){style="transform: translateY(@(user.getProfileImagePos)%)"}>
                    </div>
                </div>
            }
            @if(!edit) {
                <h1 class="pageItem bigTitle">@user.getName</h1>
                @if(subTitle != null && !subTitle.equals("")) {
                    <h3 class="pageItem bigSubTitle">@subTitle</h3>
                }
            }

            @if(!messages.isEmpty) {
                <div class="messages">@(for(message <- messages) message)</div>
            }
            <div class="pageItem info-block-container">
                @if(edit){<h3 class="bigSubTitle">BRUKERINFO</h3>}

                @if(edit) {
                    <div class="info-block">
                        <ul>
                            @infoItem(true, false, "NTNU-BRUKERNAVN", user.getUsername)
                        </ul>
                    </div>
                    <div class="info-block">
                        <ul>
                            @infoItem(true, true, "FORNAVN", user.getFirstName, "firstName")
                            @infoItem(true, true, "MELLOMNAVN", user.getMiddleName, "middleName")
                            @infoItem(true, true, "ETTERNAVN", user.getLastName, "lastName")
                        </ul>
                    </div>
                }
                <div class="info-block">
                    <ul>
                        @infoItem(!edit, false, "NTNU-E-POST", user.getUsername+"@stud.ntnu.no")

                        @infoItem(edit || user.hasEmail, edit, "ALTERNATIV E-POST", user.getEmail, "email", "email")
                        @infoItem(edit || user.hasWebsiteUrl, edit, "HJEMMESIDE", user.getWebsiteUrl, "websiteUrl")
                        @infoItem(edit || user.hasPhone, edit, "TELEFON", user.getPhone, "phone")
                    </ul>
                </div>
                <div class="info-block">
                    <ul>
                        @infoItem(edit || user.hasTitle, edit, "TITTEL", user.getTitle, "title")
                        @infoItem(edit || user.hasGraduationYear, edit, "AVGANGSÅR", user.getGraduationYear.toString, "graduationYear", "number")
                    </ul>
                </div>
            </div>

            <div class="clearfix">
            </div>
        </div>
        @if(edit) {
        </form>
        }
    </div>
} {
    <link rel="stylesheet" type="text/css" href="@routes.Assets.at("stylesheets/profile.css")" />
    <script type="text/javascript">
        function calculatePicTop(){
            var pic = $(".nedit .pic");
            pic.css("width", "auto");
            pic.css("height", "auto");
            if (pic.height() < parseFloat($(".picFrame").css("max-height"))) {
                pic.css("top", pic.height()/2 + "px");
            } else pic.css("top", "50%");
            pic.css("width", "");
            pic.css("height", "");
        }

        function uploadImage(filesParent){
            $(".picFrame .link, .picFrame .drop, .pic").addClass("hidden");
            $(".picFrame .loader").removeClass("hidden");
            uploadFile(filesParent.files[0], function(url) {
                var filename = url.substring(url.lastIndexOf("/")+1);
                $(".profile-image-file-name").val(filename);
                $(".pic").attr("src", url);
                $(".picFrame").removeClass("hidden");
                $(".picFrame .link, .pic").removeClass("hidden");
                $(".picFrame .loader").addClass("hidden");
                $(".picFrame").addClass("poof");
            }, "@user.getUsername");
            calculatePicTop();
        }

        $(document).ready(function(){
            calculatePicTop();
            $(".edit .picFrame .upload").click(function(){$(".profile-image-file-input").click()});
            $(".edit .picFrame .remove").click(function(){
                $(".pic").attr("src", "@routes.Assets.at("images/placeholder-profile.jpg")");
                $(".profile-image-file-name").val("");
                $(".picFrame .remove").addClass("hidden");
                calculatePicTop();
            });
            $(".edit .picFrame").on("dragover", function(jqe) {
                    var e = jqe.originalEvent;
                    e.stopPropagation();
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'copy';
                }).on("dragenter", function(jqe) {
                    var e = jqe.originalEvent;
                    e.stopPropagation();
                    e.preventDefault();
                    $(".picFrame").removeClass(".poof");
                }).on("dragleave", function(jqe) {
                    var e = jqe.originalEvent;
                    e.stopPropagation();
                    e.preventDefault();
                    $(".picFrame").addClass(".poof");
                }).on("drop", function(jqe) {
                    var e = jqe.originalEvent;
                    e.stopPropagation();
                    e.preventDefault();
                    uploadImage(e.dataTransfer);
                });
            $(".profile-image-file-input").change(function(){uploadImage(this);});
        });
    </script>
}